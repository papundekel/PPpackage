services:
    metamanager:
        image: docker.io/fackop/pppackage-metamanager:latest
        ulimits:
            nofile: # fakeroot issue https://github.com/moby/moby/issues/27195
                soft: 1024
                hard: 1048576
        user: $USER
        command:
            - /mnt/root/
            - --config
            - /mnt/config.json
            - --workdir
            - /mnt/workdir/
        volumes:
            - type: bind
              source: /tmp/
              target: /mnt/workdir/

            - type: bind
              source: $PWD/root/
              target: /mnt/root/

            - type: bind
              source: $PWD/output/
              target: /mnt/output/

            - type: bind
              source: $CONFIG_PATH
              target: /mnt/config.json

            - type: bind
              source: $XDG_RUNTIME_DIR/podman/podman.sock
              target: /run/podman/podman.sock

            - type: bind
              source: $PWD/database/archlinux-core/
              target: /mnt/repositories/database/archlinux-core/
            - type: bind
              source: $PWD/database/archlinux-extra/
              target: /mnt/repositories/database/archlinux-extra/
            - type: bind
              source: $PWD/database/PP/
              target: /mnt/repositories/database/PP/

            - type: bind
              source: $PWD/cache/conan/
              target: /mnt/repositories/cache/conan/
            - type: bind
              source: $PWD/cache/PP/
              target: /mnt/repositories/cache/PP/

            - type: bind
              source: /etc/passwd
              target: /etc/passwd
              read_only: true
            - type: bind
              source: /etc/group
              target: /etc/group
              read_only: true
